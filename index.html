<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temari Oposicions - Cultura General</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600&family=Montserrat:wght@400;600&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* Tu CSS completo va aquí. He añadido un pequeño estilo para el enlace de contraseña */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --text-color: #333333; --background-color: #FAFAFA; --card-background: #ffffff; --primary-color: #1E88E5; --secondary-color: #FF7043; }
        body { font-family: 'Open Sans', sans-serif; background-color: var(--background-color); color: var(--text-color); line-height: 1.6; }
        
        .auth-container { display: flex; justify-content: center; align-items: center; height: 100vh; padding: 20px; }
        .auth-box { background: var(--card-background); padding: 40px; border-radius: 12px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1); max-width: 400px; width: 100%; text-align: center; }
        .auth-box h2 { font-family: 'Montserrat', sans-serif; font-size: 24px; color: var(--primary-color); margin-bottom: 25px; }
        .auth-box input { width: 100%; padding: 12px 15px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; }
        .auth-box button { width: 100%; padding: 15px; border: none; border-radius: 8px; background-color: var(--primary-color); color: white; font-size: 18px; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease; }
        .auth-box button:hover { background-color: #1976D2; }
        .auth-toggle { margin-top: 20px; font-size: 14px; }
        .auth-toggle a { color: var(--primary-color); text-decoration: none; font-weight: 600; }
        #authError { color: #dc3545; margin-top: 15px; font-weight: 600; min-height: 20px; }
        #authSuccess { color: #28a745; margin-top: 15px; font-weight: 600; min-height: 20px; } /* NUEVO: Para mensajes de éxito */

        /* NUEVO: Estilo para el enlace de restablecer contraseña */
        .forgot-password { margin-top: 15px; font-size: 13px; }
        .forgot-password a { color: #555; text-decoration: none; }
        .forgot-password a:hover { text-decoration: underline; }
        
        /* Estilos del Quiz... */
        .main-header { padding: 20px; text-align: center; border-bottom: 3px solid var(--primary-color); background: var(--card-background); }
        .main-title { font-family: 'Lora', serif; font-size: 28px; color: var(--primary-color); }
        #userInfo { margin-top: 10px; font-size: 14px; }
        .logout-btn { background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
        .quiz-container { max-width: 900px; margin: 20px auto; padding: 20px; }
        .question-list { background: var(--card-background); border-radius: 12px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .question-item { margin-bottom: 32px; padding: 20px; border-radius: 12px; transition: all 0.4s ease; border: 1px solid #eee; }
        .question-number { color: var(--primary-color); font-weight: 600; margin-bottom: 12px; }
        .answer { color: var(--secondary-color); display: none; margin-top: 16px; padding: 16px; border-radius: 10px; border-left: 4px solid var(--secondary-color); background: rgba(255, 112, 67, 0.1); font-weight: 600; }
        .answer.show { display: block; }
        .reveal-btn { background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; transition: all 0.4s ease; margin-top: 16px; }
        .reveal-btn.hide { background: var(--secondary-color); }
    </style>
</head>
<body>
    <div id="authContainer" class="auth-container">
        <div class="auth-box">
            <h2 id="authTitle">Iniciar Sesión</h2>
            <input type="email" id="emailInput" placeholder="Correo electrónico" required>
            <input type="password" id="passwordInput" placeholder="Contraseña" required>
            <button id="authButton">Iniciar Sesión</button>
            <p id="authError"></p>
            <p id="authSuccess"></p> <!-- NUEVO: Para mensajes de éxito -->

            <!-- NUEVO: Enlace para restablecer contraseña -->
            <div id="forgotPasswordContainer" class="forgot-password">
                <a href="#" id="forgotPasswordLink">¿Olvidaste tu contraseña?</a>
            </div>

            <p class="auth-toggle" id="authToggle">
                ¿No tienes cuenta? <a href="#">Regístrate</a>
            </p>
        </div>
    </div>

    <div id="appContent" style="display: none;">
        <!-- ... Contenido de tu app (header, quiz-container, etc) ... -->
        <header class="main-header">
            <h1 class="main-title">Temari Oposicions</h1>
            <div id="userInfo"></div>
            <button id="logoutBtn" class="logout-btn">Cerrar Sesión</button>
        </header>

        <main class="quiz-container">
            <div class="question-list" id="questionList"></div>
        </main>
    </div>

    <script type="module">
        // NUEVO: Importamos sendPasswordResetEmail
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBwBaThAwh-QDyH9XQDY4Ef03LMX9z4xXM", // TU API KEY
            authDomain: "temari-oposicions.firebaseapp.com",
            projectId: "temari-oposicions",
            storageBucket: "temari-oposicions.appspot.com",
            messagingSenderId: "795136368588",
            appId: "1:795136368588:web:359df54bb55555275ac769"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const questions = [
            { id: 32, question: "Brasília és a Brasil com Albània és a...", answer: "Tirana" },
            { id: 33, question: "Quin és el nom de la muntanya més alta d'Espanya?", answer: "Teide" },
            { id: 34, question: "Quin és el país d'origen del 'Programa Apollo'?", answer: "Estats Units d'Amèrica" }
        ];

        // --- ELEMENTOS DEL DOM ---
        const authContainer = document.getElementById('authContainer');
        const appContent = document.getElementById('appContent');
        const emailInput = document.getElementById('emailInput');
        const passwordInput = document.getElementById('passwordInput');
        const authButton = document.getElementById('authButton');
        const authToggle = document.getElementById('authToggle');
        const authTitle = document.getElementById('authTitle');
        const authError = document.getElementById('authError');
        const authSuccess = document.getElementById('authSuccess'); // NUEVO
        const logoutBtn = document.getElementById('logoutBtn');
        const userInfo = document.getElementById('userInfo');
        const questionList = document.getElementById('questionList');
        const forgotPasswordLink = document.getElementById('forgotPasswordLink'); // NUEVO
        const forgotPasswordContainer = document.getElementById('forgotPasswordContainer'); // NUEVO
        
        let isLogin = true;

        // --- LÓGICA DE AUTENTICACIÓN ---
        authToggle.addEventListener('click', (e) => {
            e.preventDefault();
            isLogin = !isLogin;
            clearMessages();
            authTitle.textContent = isLogin ? 'Iniciar Sesión' : 'Registrarse';
            authButton.textContent = isLogin ? 'Iniciar Sesión' : 'Registrarse';
            authToggle.innerHTML = isLogin ? '¿No tienes cuenta? <a href="#">Regístrate</a>' : '¿Ya tienes cuenta? <a href="#">Inicia Sesión</a>';
            // NUEVO: Oculta/muestra el enlace de "olvidé contraseña"
            passwordInput.style.display = 'block';
            forgotPasswordContainer.style.display = isLogin ? 'block' : 'none';
        });

        authButton.addEventListener('click', () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            clearMessages();

            if (!email || (isLogin && !password) || (!isLogin && password.length < 6)) {
                authError.textContent = 'Por favor, completa los campos correctamente.';
                return;
            }

            if (isLogin) {
                signInWithEmailAndPassword(auth, email, password)
                    .catch(error => authError.textContent = getFirebaseErrorMessage(error));
            } else {
                createUserWithEmailAndPassword(auth, email, password)
                    .catch(error => authError.textContent = getFirebaseErrorMessage(error));
            }
        });

        // --- NUEVO: Lógica para restablecer contraseña ---
        forgotPasswordLink.addEventListener('click', (e) => {
            e.preventDefault();
            const email = emailInput.value;
            clearMessages();

            if (!email) {
                authError.textContent = 'Por favor, introduce tu email para restablecer la contraseña.';
                return;
            }

            sendPasswordResetEmail(auth, email)
                .then(() => {
                    authSuccess.textContent = '¡Correo de restablecimiento enviado! Revisa tu bandeja de entrada.';
                })
                .catch(error => {
                    authError.textContent = getFirebaseErrorMessage(error);
                });
        });


        logoutBtn.addEventListener('click', () => {
            signOut(auth);
        });

        onAuthStateChanged(auth, user => {
            if (user) {
                authContainer.style.display = 'none';
                appContent.style.display = 'block';
                userInfo.textContent = `Usuario: ${user.email}`;
                renderQuestions();
            } else {
                authContainer.style.display = 'flex';
                appContent.style.display = 'none';
            }
        });

        function clearMessages() {
            authError.textContent = '';
            authSuccess.textContent = '';
        }

        function getFirebaseErrorMessage(error) {
            switch (error.code) {
                case 'auth/user-not-found': return 'El correo electrónico no está registrado.';
                case 'auth/wrong-password': return 'La contraseña es incorrecta.';
                case 'auth/email-already-in-use': return 'Este correo electrónico ya está en uso.';
                case 'auth/invalid-email': return 'El formato del correo electrónico es inválido.';
                case 'auth/missing-password': return 'Por favor, introduce una contraseña.';
                default: return 'Ha ocurrido un error. Inténtalo de nuevo.';
            }
        }

        // --- LÓGICA DEL QUIZ (sin cambios) ---
        function renderQuestions() {
            questionList.innerHTML = '';
            questions.forEach(q => {
                const item = document.createElement('div');
                item.className = 'question-item';
                item.innerHTML = `
                    <div class="question-number">${q.id}. ${q.question}</div>
                    <button class="reveal-btn">🤔 Mostrar respuesta</button>
                    <div class="answer">${q.answer}</div>
                `;
                questionList.appendChild(item);
            });

            document.querySelectorAll('.reveal-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const answerDiv = e.target.nextElementSibling;
                    const isShown = answerDiv.classList.toggle('show');
                    e.target.textContent = isShown ? '🙈 Ocultar respuesta' : '🤔 Mostrar respuesta';
                    e.target.classList.toggle('hide', isShown);
                });
            });
        }
    </script>
</body>
</html>
